ストアドプロシージャ
=================

ストアドプロシージャを使用すると、クエリに対して特定のビューを作成し、機密情報がアーカイブされないようにできます。

ストアドプロシージャを作成し、アクセスを制限することで、誰が特定のストアドプロシージャを使用できるか、誰がどの種類の情報にアクセスできるかを区別するためのインタフェースが追加されます。
これによって特にテーブルやカラムをセキュリティの観点から制御するプロセスがより簡単に管理できます。

例を見てみましょう。

ユーザーのパスポート ID を含む情報を持つテーブルがあるとします。

このようなクエリを使用します。

```SQL
SELECT * FROM tblUsers WHERE userId = $user_input
```

[入力のバリデーション][1]の問題は置いておくとして、データベースのユーザー(例：John)は、ユーザーID を使って**すべて**の情報にアクセスできるとします。

そこでもし、John が以下のストアドプロシージャを使用する権限しか持たないように制限した場合はどうなるでしょう。

```SQL
CREATE PROCEDURE db.getName @userId int = NULL
AS
    SELECT name, lastname FROM tblUsers WHERE userId = @userId
GO
```

これだけで実行できます。

```
EXEC db.getName @userId = 14
```

この方法によって、ユーザー John がリクエストしたユーザーの `name` と `lastname` のみを閲覧できることを確実にできます。

ストアドプロシージャは万能な防御策ではありませんが、Web アプリケーションを保護するための新しいレイヤを作成できます。
ストアドプロシージャは DBA に、パーミッション制御 (例： ユーザーを特定 s の行やデータに制限する） とサパフォーマンスも向上に利益をもたらします。

[1]: /input-validation/README.md
